import{_ as t,c as i,o as s,ag as a}from"./chunks/framework.BDwTZuFy.js";const u=JSON.parse('{"title":"VPP","description":"","frontmatter":{"title":"VPP"},"headers":[],"relativePath":"VelocityPteroPower/latest/core-mechanics.md","filePath":"VelocityPteroPower/latest/core-mechanics.md"}'),o={name:"VelocityPteroPower/latest/core-mechanics.md"};function n(r,e,l,c,d,h){return s(),i("div",null,e[0]||(e[0]=[a(`<h1 id="core-mechanics-explained-üß†" tabindex="-1">Core Mechanics Explained üß† <a class="header-anchor" href="#core-mechanics-explained-üß†" aria-label="Permalink to &quot;Core Mechanics Explained üß†&quot;">‚Äã</a></h1><p>Understanding how VelocityPteroPower (VPP) manages your servers can help you configure it optimally and troubleshoot any issues. This page breaks down the key operational logic.</p><h2 id="automatic-server-starting-üöÄ" tabindex="-1">Automatic Server Starting üöÄ <a class="header-anchor" href="#automatic-server-starting-üöÄ" aria-label="Permalink to &quot;Automatic Server Starting üöÄ&quot;">‚Äã</a></h2><p>When a player attempts to connect to a server managed by VPP, a sequence of checks and actions occurs:</p><ol><li><p><strong>Managed Server Identification:</strong> VPP first checks if the target server name (from the player&#39;s connection attempt) is defined within the <code>servers</code> section of its <code>config.yml</code>. If not, VPP does not manage this server, and the connection proceeds as Velocity normally would.</p></li><li><p><strong>Whitelist Check (Conditional):</strong></p><ul><li>If the server&#39;s configuration in <code>config.yml</code> has <code>whitelist: true</code>: <ul><li>VPP consults its cached whitelist for that server.</li><li>If <code>whitelistAllowBypass: true</code> (global config) AND the player has the <code>ptero.bypass</code> permission, this check is skipped.</li><li>Otherwise, if the player is not on the cached whitelist, the connection attempt will be denied or the server start will be prevented.</li></ul></li></ul><div class="warning custom-block"><p class="custom-block-title">MC Server Soft Limitation</p><p>The whitelist fetching and enforcement feature is <strong>not supported</strong> if your panel is MC Server Soft. Whitelist checks will be skipped for such panels.</p></div></li><li><p><strong>Player Start Cooldown:</strong> VPP checks if the player is currently under a cooldown period (defined by <code>playerStartCooldown</code> in <code>config.yml</code>) from recently initiating a server start. If on cooldown, the current start attempt will be denied.</p></li><li><p><strong>Server Status Query:</strong> VPP determines if the target server is already online. This is done using the method specified by <code>serverStatusCheckMethod</code> in <code>config.yml</code>:</p><ul><li><strong><code>VELOCITY_PING</code></strong>: Sends a standard Minecraft ping.</li><li><strong><code>PANEL_API</code></strong>: Queries the panel API for the server&#39;s state. If the server is found to be online, the player&#39;s connection proceeds normally, and VPP ensures any internal &quot;starting&quot; flags for that server are cleared.</li></ul></li><li><p><strong>Offline Server - Startup Sequence:</strong> If the server is determined to be offline:</p><ul><li><strong>Starting Flag:</strong> VPP checks if the server is already internally marked as &quot;starting&quot; (e.g., by another player&#39;s recent attempt). If so, the current player might be informed and their connection denied or queued for limbo (if a limbo is configured).</li><li><strong>Rate Limit Check:</strong> Before sending any API command, VPP checks if it can make a request without exceeding panel API rate limits. If rate-limited, the start is aborted, and the player and console is notified.</li><li><strong>API Start Signal:</strong> If all checks pass, VPP sends a &quot;start&quot; signal for the server&#39;s ID to the panel API.</li><li><strong>Internal State Update:</strong> The server is marked internally as &quot;starting,&quot; and the initiating player&#39;s start cooldown is activated.</li><li><strong>Initial Idle Check Scheduled:</strong> If <code>idleStartShutdownTime</code> is configured (&gt;= 0), a task is scheduled to shut down this server if no one joins it within that time.</li></ul></li><li><p><strong>Player Handling During Startup:</strong></p><ul><li><strong>Limbo Redirection:</strong> If a valid limbo (from <code>lobbyBalancer.limbos</code>) is available, the player is sent there with a notification while the target starts. If the player is already on a limbo when trying again, they remain there.</li><li><strong>Initiator-specific message:</strong> The player who actually triggered the start receives a clearer notice that &quot;You‚Äôve started server <code>&lt;server&gt;</code>. Please wait while it boots...&quot; while others see that the server is already starting.</li><li><strong>Auto-queue for delayed connect:</strong> Players attempting to join a server that is in the &quot;starting&quot; state are automatically queued. VPP will try to connect them once the server is online and past the join delay.</li><li><strong>Disconnect/Message:</strong> If no limbo is available (or if it&#39;s the player&#39;s initial proxy connection), the player will be disconnected with a message that the server is starting, or if they were on a previous server, they will just receive a message and the connection attempt is denied.</li></ul></li><li><p><strong>Delayed Connection to Target Server:</strong></p><ul><li>VPP schedules a recurring task (initial delay: <code>startupInitialCheckDelay</code>, subsequent checks based on per-server <code>startupJoinDelay</code>) to monitor the target server&#39;s status.</li><li>Once the server is confirmed online (via <code>serverStatusCheckMethod</code>), VPP waits for the additional <code>startupJoinDelay</code> (per-server config) to allow backend plugins to load.</li><li>After this full delay, if the player is still active (e.g., on limbo or attempting to reconnect), VPP attempts to connect them to the now-started target server.</li><li>If the server doesn&#39;t start within a reasonable number of attempts, the connection task is cancelled, and the player is informed (if connected to the proxy).</li></ul></li></ol><h3 id="startup-state-cleanup-sweep" tabindex="-1">Startup State Cleanup Sweep <a class="header-anchor" href="#startup-state-cleanup-sweep" aria-label="Permalink to &quot;Startup State Cleanup Sweep&quot;">‚Äã</a></h3><p>To prevent rare cases where a server could remain marked as &quot;starting&quot; indefinitely (e.g., panel never reports success and the attempt has already timed out), VPP periodically runs a small cleanup sweep:</p><ul><li>The sweep runs about every 60 seconds in the background.</li><li>For each server flagged as starting, VPP re-checks the real status (respecting your configured status method and rate limits).</li><li>If the server is online, VPP clears the starting state.</li><li>If it has exceeded a safe maximum startup window (derived from <code>startupInitialCheckDelay</code> and repeated join checks), VPP also clears the stuck state so future attempts can proceed.</li></ul><p>This helps keep the system healthy even if an earlier attempt didn‚Äôt complete cleanly.</p><hr><h2 id="automatic-server-shutdown-üí§" tabindex="-1">Automatic Server Shutdown üí§ <a class="header-anchor" href="#automatic-server-shutdown-üí§" aria-label="Permalink to &quot;Automatic Server Shutdown üí§&quot;">‚Äã</a></h2><p>VPP employs several mechanisms to automatically shut down servers, conserving resources:</p><ol><li><p><strong>Timeout-Based Shutdown (Per-Server <code>timeout</code>):</strong></p><ul><li><strong>Trigger:</strong> When the last player disconnects from a VPP-managed server, or when a server becomes empty after a player switches away from it.</li><li><strong>Action:</strong> VPP checks the <code>timeout</code> value for that specific server in <code>config.yml</code>. <ul><li>If <code>timeout: -1</code>, automatic shutdown for this server is disabled.</li><li>If <code>timeout: 0</code>, VPP attempts to send a &quot;stop&quot; signal immediately.</li><li>If <code>timeout &gt; 0</code> (seconds), a shutdown task is scheduled. If a player rejoins before the task executes, the shutdown is cancelled. Otherwise, a &quot;stop&quot; signal is sent.</li></ul></li></ul></li><li><p><strong>Idle Start Shutdown (Global <code>idleStartShutdownTime</code>):</strong></p><ul><li><strong>Trigger:</strong> A server was started by VPP, but no player successfully connected to it within the <code>idleStartShutdownTime</code> (global config).</li><li><strong>Action:</strong> VPP sends a &quot;stop&quot; signal to the panel API for that server.</li></ul></li><li><p><strong>Shutdown Confirmation &amp; Retries:</strong></p><ul><li>After VPP sends a &quot;stop&quot; signal, it doesn&#39;t just assume the server stopped.</li><li>A follow-up task is scheduled (after <code>shutdownRetryDelay</code> seconds) to check the server&#39;s status via the panel API.</li><li><strong>If Still Online &amp; Empty:</strong> If the server is still reported as online by the panel and is confirmed empty by VPP, it will retry sending the &quot;stop&quot; signal. This retry process occurs up to <code>shutdownRetries</code> times.</li><li><strong>If Offline or Players Joined:</strong> If the server is offline, the process completes. If players have joined, the shutdown attempt is cancelled.</li><li>This retry mechanism helps handle cases where the panel might be slow to process the stop command or if the initial signal failed.</li></ul></li><li><p><strong>Online-only Scheduling &amp; Always-online Override:</strong></p><ul><li>VPP only schedules an idle shutdown when the server is actually online. If a server is offline or its status is unknown, existing deadlines are cleared and no new shutdown is scheduled.</li><li>Servers listed under <code>alwaysOnline</code> will not have idle shutdowns scheduled at all, even if a per-server <code>timeout</code> is configured. The <code>alwaysOnline</code> rule outranks per-server settings.</li></ul></li><li><p><strong>Failsafe Idle Sweep:</strong></p><ul><li>In addition to event-based scheduling, VPP periodically runs an idle-shutdown sweep (interval controlled by <code>idleShutdownCheckInterval</code>, in seconds).</li><li>The sweep scans all managed servers and schedules shutdowns for empty ones (respecting <code>alwaysOnline</code>, per-server <code>timeout</code>, and the online-only rule). This ensures shutdowns are enforced even if events are missed.</li></ul></li></ol><hr><h2 id="limbo-functionality-üèùÔ∏è" tabindex="-1">Limbo Functionality üèùÔ∏è <a class="header-anchor" href="#limbo-functionality-üèùÔ∏è" aria-label="Permalink to &quot;Limbo Functionality üèùÔ∏è&quot;">‚Äã</a></h2><p>Limbo lets players wait on a lightweight server while their target server starts.</p><div class="tip custom-block"><p class="custom-block-title">Purpose of Limbo</p><p>Instead of disconnecting players or leaving them on a &quot;Connecting...&quot; screen, they can be temporarily moved to a lightweight, always-on (or very quickly starting) &quot;limbo&quot; server.</p></div><ul><li><p><strong>How it Works:</strong></p><ol><li>A player attempts to connect to an offline VPP-managed server (<code>Server-A</code>).</li><li>VPP initiates the startup of <code>Server-A</code>.</li><li>If a limbo from your <code>lobbyBalancer.limbos</code> list is available and registered in <code>velocity.toml</code>, VPP redirects the player there.</li><li>The player receives a message indicating they are being sent to limbo while <code>Server-A</code> starts.</li><li>VPP monitors <code>Server-A</code>&#39;s startup.</li><li>Once <code>Server-A</code> is online and its <code>startupJoinDelay</code> has passed, VPP attempts to automatically connect the player from <code>Lobby-Lite</code> to <code>Server-A</code>.</li></ol></li><li><p><strong>Configuration is Key:</strong></p><ul><li>Each limbo listed under <code>lobbyBalancer.limbos</code> <strong>must</strong> exist in your <code>velocity.toml</code>.</li><li>If the limbo server itself is managed by VPP, ensure its <code>timeout</code> setting is appropriate (e.g., <code>-1</code> to prevent auto-shutdown, or a very short <code>timeout</code> if it&#39;s designed to be ephemeral but also quick to start via VPP).</li></ul></li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The Limbo server can be any kind of Minecraft server, but it is recommended to use a very lightweight server type to first have a always on lightweight server online and if that is offline to be quickly started.</p></div><hr><h2 id="api-rate-limiting-üö¶" tabindex="-1">API Rate Limiting üö¶ <a class="header-anchor" href="#api-rate-limiting-üö¶" aria-label="Permalink to &quot;API Rate Limiting üö¶&quot;">‚Äã</a></h2><p>Server control panels like Pterodactyl and Pelican implement API rate limits to prevent abuse and ensure stability. VPP is designed to work within these limits.</p><ul><li><strong>Detection:</strong> VPP attempts to read rate limit information from the HTTP headers returned by panel API responses (e.g., <code>X-RateLimit-Limit</code>, <code>X-RateLimit-Remaining</code>).</li><li><strong>Behavior:</strong> If VPP anticipates that an API request would exceed the remaining quota, it will temporarily pause or deny actions that require an API call (e.g., starting a server, checking status via <code>PANEL_API</code>, stopping a server). Players or console may receive a message indicating the delay.</li><li><strong>Monitoring:</strong> You can set <code>printRateLimit: true</code> in <code>config.yml</code> to have VPP log the rate limit status it receives from the panel. This is very helpful for diagnosing if rate limiting is causing unexpected behavior.</li><li><strong><code>apiThreads</code>:</strong> This setting in <code>config.yml</code> controls the number of threads VPP can use for concurrent API operations. While increasing it might seem beneficial for many servers, it can also lead to hitting rate limits more quickly if not carefully managed. The default (<code>10</code>) is generally a good starting point.</li></ul><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Mc Server Soft does not have any rate limiting in place.</p></div><hr><h2 id="server-status-checking-methods-serverstatuscheckmethod" tabindex="-1">Server Status Checking Methods (<code>serverStatusCheckMethod</code>) <a class="header-anchor" href="#server-status-checking-methods-serverstatuscheckmethod" aria-label="Permalink to &quot;Server Status Checking Methods (\`serverStatusCheckMethod\`)&quot;">‚Äã</a></h2><p>VPP offers two distinct methods to determine if a managed Minecraft server is online and ready for connections:</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-wR0oJ" id="tab-2RjMErA" checked><label data-title="VELOCITY_PING" for="tab-2RjMErA">VELOCITY_PING</label><input type="radio" name="group-wR0oJ" id="tab-8u_RyNR"><label data-title="PANEL_API" for="tab-8u_RyNR">PANEL_API</label></div><div class="blocks"><div class="language-yaml vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Uses Velocity&#39;s built-in server pinging.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Pros:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - No panel API calls, so no impact on rate limits.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - Generally faster than an API call.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Cons:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - Server must be correctly defined in velocity.toml and network-reachable.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - Might report &quot;online&quot; before backend plugins fully load.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - Some minimal servers (e.g., basic limbo) might not respond to pings.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Relies on \`pingTimeout\` setting.</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">serverStatusCheckMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;VELOCITY_PING&quot;</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Queries the Pterodactyl/Pelican panel API for server state.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Pros:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - More authoritative status directly from the panel (e.g., &quot;running&quot;).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Cons:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - Consumes an API request for each check, impacting rate limits.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - Can be slightly slower due to network latency to the panel.</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">serverStatusCheckMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;PANEL_API&quot;</span></span></code></pre></div></div></div><p>Choose the method that best balances accuracy, API usage, and your network setup. For most, <code>VELOCITY_PING</code> is efficient, but <code>PANEL_API</code> can be more reliable for determining true process state if pings are problematic.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>If the Panel is in the same Network or even server, the &quot;PANEL_API&quot; is a reliable choice as it has low latency and is accurate with any Server type.</p></div><hr><h2 id="whitelist-feature-integration-‚úÖ" tabindex="-1">Whitelist Feature Integration ‚úÖ <a class="header-anchor" href="#whitelist-feature-integration-‚úÖ" aria-label="Permalink to &quot;Whitelist Feature Integration ‚úÖ&quot;">‚Äã</a></h2><p>VPP can integrate with the <code>whitelist.json</code> file of your backend Minecraft servers (managed via the panel).</p><ul><li><strong>Enabling:</strong> For each server in the <code>servers:</code> section of <code>config.yml</code>, set <code>whitelist: true</code>.</li><li><strong>Fetching Mechanism:</strong><ul><li>VPP attempts to download the content of <code>whitelist.json</code> from the server&#39;s file directory using the panel API.</li><li>This occurs: <ul><li>On plugin startup/reload.</li><li>Periodically, based on <code>whitelistCheckInterval</code> (if &gt; 0).</li><li>Manually, via the <code>/ptero whitelistReload</code> command.</li></ul></li></ul></li><li><strong>Enforcement Logic (when a player tries to connect/start a whitelisted server):</strong><ol><li>If <code>whitelistAllowBypass: true</code> (global config) AND the player has the <code>ptero.bypass</code> permission, VPP&#39;s whitelist check is skipped.</li><li>Otherwise, VPP checks if the player&#39;s username is present in its cached copy of that server&#39;s whitelist.</li><li>If not found, the connection/start attempt will be denied by VPP.</li></ol></li></ul><div class="danger custom-block"><p class="custom-block-title">MC Server Soft Incompatibility</p><p>The panel API functionality required for VPP to fetch <code>whitelist.json</code> is <strong>not available on MC Server Soft panels.</strong> If VPP detects this panel type, the whitelist feature will be disabled.</p></div><div class="tip custom-block"><p class="custom-block-title">Backend Server Still Enforces</p><p>VPP&#39;s whitelist check is a <em>preliminary</em> check. The backend Minecraft server itself will <strong>always</strong> enforce its own <code>whitelist.json</code> file. If a player somehow bypasses VPP&#39;s check but isn&#39;t on the actual server whitelist, they will still be denied entry by the Minecraft server.</p></div><h2 id="server-list-ttl-overview-‚è±Ô∏è" tabindex="-1">Server List (TTL) Overview ‚è±Ô∏è <a class="header-anchor" href="#server-list-ttl-overview-‚è±Ô∏è" aria-label="Permalink to &quot;Server List (TTL) Overview ‚è±Ô∏è&quot;">‚Äã</a></h2><p>The <code>/ptero list</code> command shows a compact overview of all managed servers with a TTL (time-to-shutdown) indicator:</p><ul><li>If a shutdown has already been scheduled (after the last player left), TTL shows the live remaining time.</li><li>If the server is currently empty but no countdown exists yet, TTL shows the configured per-server <code>timeout</code> as a preview.</li><li>Servers in <code>alwaysOnline</code> display <code>‚Äî</code> because they are not auto-shutdown by VPP.</li></ul><p>Status in the list is resolved using your configured <code>serverStatusCheckMethod</code> (either <code>VELOCITY_PING</code> or <code>PANEL_API</code>). When <code>PANEL_API</code> is used, VPP leverages a short resource-usage cache to avoid unnecessary API calls.</p>`,40)]))}const g=t(o,[["render",n]]);export{u as __pageData,g as default};
